<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link rel="stylesheet" type="text/css" href="./stylesv1.css"> 
    <link href='https://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet'>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" crossorigin="anonymous">
    <title>Expense Calculator Dashboard</title>
</head>
<body>
    
    <div class="container">
 <span id="user-id"></span>

        <header>
            <div><span style="color: white; font-size: 16px; font-family: Nothing Font (5x7); font-weight: 400; word-wrap: break-word">Ku</span><span style="color: #EEFF00; font-size: 16px; font-family: Nothing Font (5x7); font-weight: 400; word-wrap: break-word">DicK</span><span style="color: white; font-size: 16px; font-family: Nothing Font (5x7); font-weight: 400; word-wrap: break-word">Ka</span></div>            <button id="logoutButton1">Logout </button>
            <div id="success-message" class="message" style="display: none;"></div>
        </header>
        <br>
        <br>
        <br>
        <section class="kpi-container">
            <div class="kpi-box expense" id="expense-section" style="display: none;">
                <h3> Expense</h3>
                <p id="expense-amount" class="currency-inr">₹ 0.00</p>
            </div>
            
            <div class="kpi-box income" id="income-section" style="display: none;">
                <h3> Income</h3>
                <p id="income-amount" class="currency-inr">₹ 0.00</p>
            </div>
            
            <div class="kpi-box balance" id="balance-section">
                <h3> Balance</h3>
                <p id="balance-amount" class="currency-inr">₹ 0.00</p>
    
<button class="arrow-button" id="balance-button">
    <svg viewBox="0 0 320 512" height="1em" xmlns="http://www.w3.org/2000/svg" class="chevron-right">
    <path d="M310.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-192 192c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L242.7 256 73.4 86.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l192 192z"></path>
</svg>
</button>
<button class="arrow-button" id="expense-button">
<svg viewBox="0 0 320 512" height="1em" xmlns="http://www.w3.org/2000/svg" class="chevron-right">
    <path d="M310.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-192 192c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L242.7 256 73.4 86.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l192 192z"></path>
</svg>
</button>
<button class="arrow-button" id="income-button">
<svg viewBox="0 0 320 512" height="1em" xmlns="http://www.w3.org/2000/svg" class="chevron-right">
    <path d="M310.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-192 192c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L242.7 256 73.4 86.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l192 192z"></path>
</svg>
</button> 

  </div>
            </div>            
            </div>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
        </section>
        <section class="history">
            <h3>Latest transactions:</h3>
            <div class="history-entries-container" id="history-entries-container">
                <div id="history-table-body"></div>

                <!-- Transaction entries will be dynamically added here -->
            </div>
        </section>
    </div>
    

    <!-- Navbar codes -->

    <div class="navbar">
        <a href="#home" class="nav-item"><i class="fas fa-home"></i><span>Home</span></a>
        <a href="/dashboard.html" class="nav-item"><i class="fas fa-exchange-alt"></i><span>Transaction</span></a>
        <div class="nav-item nav-center">
            <a href="/search.html" class="nav-center-btn"><i class="fas fa-plus"></i></a>
        </div>
        <a href="#" class="nav-item"><i class="fas fa-chart-pie"></i><span>Report</span></a>
        <a href="./profile.html" class="nav-item"><i class="fas fa-user"></i><span>Profile</span></a>
    </div>
    
<!-- Logout Confirmation Popup -->
<div class="popup" id="logoutPopup">
    <div class="popup-content1">
        <div class="popup-title2">Do you want to logout?</div>
        <div><span style="color: white; font-size: 10px; font-family: Montserrat; font-weight: 600; word-wrap: break-word">This will log you out from </span><span style="color: white; font-size: 10px; font-family: Montserrat; font-weight: 500; word-wrap: break-word"> </span><span style="color: white; font-size: 10px; font-family: Nothing Font (5x7); font-weight: 400; word-wrap: break-word">Ku</span><span style="color: #EEFF00; font-size: 10px; font-family: Nothing Font (5x7); font-weight: 400; word-wrap: break-word">DicK</span><span style="color: white; font-size: 10px; font-family: Nothing Font (5x7); font-weight: 400; word-wrap: break-word">Ka</span></div>        <div class="popup-buttons">
            <br>
            <button id="cancelButton">Cancel</button>
            <button id="confirmButton">Confirm</button>
        </div>
    </div>
</div>

</body>
<script>
    document.addEventListener('DOMContentLoaded', function() {

    // Define the transactions variable at a higher scope
const transactions = [];

// Initialize Firebase (if not already initialized)
var firebaseConfig = {
    apiKey: "AIzaSyCZfnZbZIKR1zyywjrXJu0MJOjETO35aTE",
  authDomain: "split-bill-6c19e.firebaseapp.com",
  databaseURL: "https://split-bill-6c19e-default-rtdb.firebaseio.com",
  projectId: "split-bill-6c19e",
  storageBucket: "split-bill-6c19e.appspot.com",
  messagingSenderId: "297198677510",
  appId: "1:297198677510:web:9cec9889c3224da9735d87"
};
    firebase.initializeApp(firebaseConfig);

// Reference to the Firebase database
const database = firebase.database();

// Get the authenticated user's ID
let authUserId;
firebase.auth().onAuthStateChanged((user) => {
  if (user) {
    authUserId = user.uid;
    displayLatestTransactions();
  }
});

// Function to display the latest transactions
function displayLatestTransactions() {
  // Reference to the user's transaction history
  const userTransactionsRef = database.ref(`users/${authUserId}/transactions`);

  // Get the latest transactions (limit to, for example, 5)
  userTransactionsRef.orderByChild('timestamp').limitToLast(5).once('value')
    .then((snapshot) => {
      const historyTableBody = document.getElementById('history-table-body');
      historyTableBody.innerHTML = ''; // Clear existing entries

      snapshot.forEach((transactionSnapshot) => {
        const transactionData = transactionSnapshot.val();

        // Create HTML elements for each transaction entry
        const transactionEntry = document.createElement('div');
        transactionEntry.classList.add('history-entry');

        const date = new Date(transactionData.timestamp);
        const formattedDate = date.toLocaleString(); // Adjust the format as needed

        transactionEntry.innerHTML = `
          <p><strong>Amount:</strong> ${transactionData.amount} INR</p>
          <p><strong>Total Amount:</strong> ${transactionData.totalAmount} INR</p>
          <p><strong>Split Option:</strong> ${transactionData.splitOption}</p>
          <p><strong>Percentage:</strong> ${transactionData.percentage}%</p>
          <p><strong>Custom Amount:</strong> ${transactionData.customAmount} INR</p>
          <p><strong>Who Paid:</strong> ${transactionData.whoPaid}</p>
          <p><strong>User's Share:</strong> ${transactionData.userAmount} INR</p>
          <p><strong>Friend's Share:</strong> ${transactionData.friendAmount} INR</p>
          <p><strong>Timestamp:</strong> ${formattedDate}</p>
        `;

        // Append the transaction entry to the history table body
        historyTableBody.appendChild(transactionEntry);
      });
    })
    .catch((error) => {
      console.error('Error fetching transactions:', error);
    });
}

// Get the logout button and the popup elements
const logoutButton = document.getElementById('logoutButton1'); // Updated ID
const logoutPopup = document.getElementById('logoutPopup');
const cancelButton = document.getElementById('cancelButton');
const confirmButton = document.getElementById('confirmButton');

// Add click event listener to the logout button
logoutButton.addEventListener('click', function() {
    logoutPopup.style.display = 'flex'; // Show the popup
});

// Add click event listeners to the popup buttons
cancelButton.addEventListener('click', function() {
    logoutPopup.style.display = 'none'; // Hide the popup on cancel
});

confirmButton.addEventListener('click', function() {
    logout(); // Call the logout function on confirm
    logoutPopup.style.display = 'none'; // Hide the popup after logout
});
    // Function to log out the user
    function logout() {
        try {
            firebase.auth().signOut().then(function() {
                // Sign-out successful, redirect to the login page
                window.location.href = '../index.html';
            }).catch(function(error) {
                // Handle sign-out error
                console.error('Logout error:', error);
            });
        } catch (error) {
            console.error('Logout error (try-catch):', error);
        }
    }

// Function to handle the click event of the "+" sign
const addButton = document.getElementById('addButton');
    // Show the popup when the "+" sign is clicked
    addButton.addEventListener('click', function() {
        window.location.href = './search.html';

});



// Function to handle the click event of the toggle buttons
document.getElementById('toggle-expense').addEventListener('click', function() {
    // Remove "active" class from income button
    document.getElementById('toggle-income').classList.remove('active');
    // Add "active" class to expense button
    this.classList.add('active');
    // Update the popup title
    document.getElementById('popup-title').textContent = 'Add Expense 😭';
});

document.getElementById('toggle-income').addEventListener('click', function() {
    // Remove "active" class from expense button
    document.getElementById('toggle-expense').classList.remove('active');
    // Add "active" class to income button
    this.classList.add('active');
    // Update the popup title
    document.getElementById('popup-title').textContent = 'Add Income 😍';
});

// Function to refresh the page
function refreshPage() {
    location.reload();
}

// // Function to handle form submission and store data in the database
// document.getElementById('popup-form').addEventListener('submit', function(event) {
//     event.preventDefault(); // Prevent the form from submitting traditionally

//     // Get the form values
//     const amount = parseFloat(document.getElementById('amount').value);
//     const date = document.getElementById('date').value;
//     const category = document.getElementById('category').value;
//     const account = document.getElementById('account').value;

//     // Determine whether it's an income or expense based on the selected toggle button
//     const isExpense = document.getElementById('toggle-expense').classList.contains('active');
//     const isIncome = document.getElementById('toggle-income').classList.contains('active');

//     // Create a reference to the user's data in the database (replace 'userId' with the actual user ID)
//     const userId = firebase.auth().currentUser.uid;

//     // Create a new transaction object with a timestamp
//     const transaction = {
//         amount: isExpense ? -amount : amount,
//         date: date,
//         category: category,
//         account: account, // Add a comma here
//         timestamp: firebase.database.ServerValue.TIMESTAMP
//     };
//     // Choose the appropriate database reference based on the transaction type
//     const transactionTypeRef = isExpense ? 'expenses' : 'income';

//     // Create a reference to the user's expenses or income node and push the new transaction
//     const userTransactionRef = firebase.database().ref('users/' + userId + '/' + transactionTypeRef);
//     userTransactionRef.push(transaction, function(error) {
//         if (error) {
//             console.error('Error adding transaction:', error);
//         } else {
//             // Clear the form and hide the popup on success
//             document.getElementById('popup-form').reset();
//             document.getElementById('popup').style.display = 'none';
//             // Show success message
//             document.getElementById('success-message').style.display = 'block';
//             setTimeout(function() {
//                 // Hide success message after a delay
//                 document.getElementById('success-message').style.display = 'none';
//                 // Refresh the page
//                 location.reload();
//             }, 1000);
//         }
//     });
// });

// // Function to handle the click event of the close button
// document.getElementById('close-popup').addEventListener('click', function() {
//     // Hide the popup when the close button is clicked
//     document.getElementById('popup').style.display = 'none';
// });
// });

// Disable zooming on the entire document
document.addEventListener('gesturestart', function (e) {
    e.preventDefault();
});

// Prevent pinch-to-zoom and double-tap gestures
document.addEventListener('touchmove', function(event) {
    if(event.scale !== 1) {
        event.preventDefault();
    }
}, { passive: false });

// Alternative method to prevent pinch-to-zoom on older Android devices
document.addEventListener('touchstart', function(event) {
    if(event.touches.length > 1) {
        event.preventDefault();
    }
}, { passive: false });


// Get the button element by its id
const hapticButton = document.getElementById('addButton');

// Function to trigger haptic feedback
function triggerHapticFeedback() {
    // Check if the 'vibrate' method is supported by the browser
    if (navigator.vibrate) {
        // Vibrate for 100 milliseconds
        navigator.vibrate(100);
    } else {
        // Fallback for browsers that do not support haptic feedback
        console.log("Haptic feedback is not supported on this device.");
    }
}

// Add click event listener to the button and trigger haptic feedback
hapticButton.addEventListener('click', triggerHapticFeedback);

    // Get the current URL
    const currentURL = window.location.href;

    // Get the navigation items (anchor tags) and their child icons
    const navItems = document.querySelectorAll('.navbar .nav-item');
    
    // Loop through each nav item and check if the URL matches
    navItems.forEach(item => {
        const link = item.getAttribute('href');
        const icon = item.querySelector('i');
        if (currentURL.includes(link)) {
            item.classList.add('active'); // Highlight the nav item
            icon.classList.add('active'); // Highlight the icon
        }
    });
});


</script>
</html>